{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["/*\r\n * Created with @iobroker/create-adapter v2.2.1\r\n */\r\n\r\n// The adapter-core module gives you access to the core ioBroker functions\r\n// you need to create an adapter\r\nimport * as utils from '@iobroker/adapter-core';\r\nimport yahooFinance from 'yahoo-finance2';\r\n\r\nclass StockMarket extends utils.Adapter {\r\n\r\n\r\n    private myInterval: any;\r\n    private interval = 0;\r\n    private symbols = [];\r\n\r\n\r\n    public constructor(options: Partial<utils.AdapterOptions> = {}) {\r\n        super({\r\n            ...options,\r\n            name: 'yahoo-stock-market',\r\n        });\r\n        this.on('ready', this.onReady.bind(this));\r\n        this.on('unload', this.onUnload.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Is called when databases are connected and adapter received configuration.\r\n     */\r\n    private async onReady(): Promise<void> {\r\n        this.log.info('initialize yahoo-stock-market adapter');\r\n\r\n\r\n        this.symbols = this.config.symbols;\r\n        if(this.symbols.length <= 0 || this.symbols == undefined) {\r\n            this.log.error('No stock symbols set. Please edit your adapter settings and restart this adapter!');\r\n            return;\r\n        }\r\n\r\n        this.interval = this.config.interval;\r\n        if(this.interval  <= 0) {\r\n            this.log.error('No interval set. Please edit your adapter settings and restart this adapter!');\r\n            return;\r\n        }\r\n\r\n        //initial call\r\n        this.readStockMarket();\r\n\r\n        //start Interval\r\n        this.myInterval =  this.setInterval(() => this.readStockMarket(), (this.interval * 60) * 1000);\r\n    }\r\n\r\n    private readStockMarket(): void {\r\n\r\n        this.log.debug('stocks to check: ' + this.symbols);\r\n\r\n        //For each symbol ask API\r\n        this.symbols.forEach( symbol => {\r\n            yahooFinance.quoteSummary(symbol, {\r\n                // 1. Try adding, removing or changing modules\r\n                // You'll get suggestions after typing first quote mark (\")\r\n                modules: ['price']\r\n            }).then( result => {\r\n                this.setNewStockObjects(symbol, result);\r\n                this.log.debug(\"Api return: '\" + JSON.stringify(result) + \"'\");\r\n\r\n                this.log.debug('stocks to check: ' + this.config.symbols);\r\n            }).catch(err => {\r\n                this.log.error('Error on APi Call for symbol: ' + symbol);\r\n                this.log.error(err.toString());\r\n            });\r\n        });\r\n    }\r\n\r\n    async setNewStockObjects(symbol: string, apiResult: any): Promise<void> {\r\n        //Dot ion symbol brokes with iobroker\r\n        symbol = symbol.replace('.', ':');\r\n\r\n        //shortname\r\n        await this.setObjectNotExistsAsync(symbol + '.shortName', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'shortName',\r\n                role: 'info',\r\n                type: 'string',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.shortName', apiResult.price.shortName, true);\r\n\r\n        //longName\r\n        await this.setObjectNotExistsAsync(symbol + '.longName', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'longName',\r\n                role: 'info',\r\n                type: 'string',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.longName', apiResult.price.longName, true);\r\n\r\n        //currency\r\n        await this.setObjectNotExistsAsync(symbol + '.currency', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'currency',\r\n                role: 'info',\r\n                type: 'string',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.currency', apiResult.price.currency, true);\r\n\r\n        //exchangeName\r\n        await this.setObjectNotExistsAsync(symbol + '.exchangeName', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'exchangeName',\r\n                role: 'info',\r\n                type: 'string',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.exchangeName', apiResult.price.exchangeName, true);\r\n\r\n        //regularMarketOpen\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketOpen', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketOpen',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketOpen', parseFloat(apiResult.price.regularMarketOpen), true);\r\n\r\n        //regularMarketPreviousClose\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketPreviousClose', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketPreviousClose',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketPreviousClose', parseFloat(apiResult.price.regularMarketPreviousClose), true);\r\n\r\n        //regularMarketPreviousClose\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketPreviousClose', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketPreviousClose',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketPreviousClose', parseFloat(apiResult.price.regularMarketPreviousClose), true);\r\n\r\n        //regularMarketVolume\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketVolume', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketVolume',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketVolume', parseInt(apiResult.price.regularMarketVolume), true);\r\n\r\n        //regularMarketDayLow\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketDayLow', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketDayLow',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketDayLow', parseFloat(apiResult.price.regularMarketDayLow), true);\r\n\r\n        //regularMarketDayHigh\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketDayHigh', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketDayHigh',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketDayHigh', parseFloat(apiResult.price.regularMarketDayHigh), true);\r\n\r\n        //regularMarketPrice\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketPrice', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketPrice',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketPrice', parseFloat(apiResult.price.regularMarketPrice), true);\r\n\r\n        //regularMarketChange\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketChange', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketChange',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketChange', parseFloat(apiResult.price.regularMarketChange), true);\r\n\r\n        //regularMarketChangePercent\r\n        await this.setObjectNotExistsAsync(symbol + '.regularMarketChangePercent', {\r\n            type: 'state',\r\n            common: {\r\n                name: 'regularMarketChangePercent',\r\n                role: 'value',\r\n                type: 'number',\r\n                write: false,\r\n                read: true,\r\n            },\r\n            native: {},\r\n        }).catch((error) => {\r\n            this.log.error(error);\r\n        });\r\n        await this.setStateAsync(symbol + '.regularMarketChangePercent', parseFloat(apiResult.price.regularMarketChangePercent) * 100, true);\r\n    }\r\n\r\n    /**\r\n     * Is called when adapter shuts down - callback has to be called under any circumstances!\r\n     */\r\n    private onUnload(callback: () => void): void {\r\n        try {\r\n            clearTimeout(this.myInterval);\r\n\r\n            callback();\r\n        } catch (e) {\r\n            callback();\r\n        }\r\n    }\r\n\r\n    private async deleteOldObject(stockKey: string, index: number): Promise<void> {\r\n        const delObject = await this.getObjectAsync(stockKey + '.' + index + '.close')\r\n\r\n        if (delObject) {\r\n            this.log.debug('Found old Objects for key - ' + stockKey +' and index - ' + index.toString());\r\n            await this.delObjectAsync(stockKey + '.' + index, {recursive:true});\r\n            // Have one delted, next round\r\n            await this.deleteOldObject(stockKey, index+1);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nif (require.main !== module) {\r\n    // Export the constructor in compact mode\r\n    module.exports = (options: Partial<utils.AdapterOptions> | undefined) => new StockMarket(options);\r\n} else {\r\n    // otherwise start the instance directly\r\n    (() => new StockMarket())();\r\n}"],
  "mappings": "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",
  "names": ["yahooFinance"]
}
